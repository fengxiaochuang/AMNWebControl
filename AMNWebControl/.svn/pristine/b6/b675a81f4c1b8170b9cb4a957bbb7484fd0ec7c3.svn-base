--create table mfscashanlysis
--(
--	compno				varchar(10)		null,
--	compname			varchar(20)		null,
--	staffno				varchar(20)		null,
--	staffname			varchar(30)		null,
--	staffinid			varchar(20)		null,
--	arrivaldate			varchar(10)		null,
--	cash_0401			float			null,
--	cash_0402			float			null,
--	cash_0403			float			null,
--	cash_0404			float			null,
--)





 --create table allstaff_work_analysis_04      
 --(   
	--compid		varchar(10)		null,--月份   
	--mmonth		varchar(10)		null,--月份
	--person_inid   varchar(20)   NULL, --员工内部编号      
	--staffno    varchar(30)   NULL, --员工工号      
	--staffname   varchar(30)   NULL, --员工姓名      
	--staffposition  varchar(30)   NULL, --员工职位      
	--oldcostcount  float    NULL, --老客项目数      
	--newcostcount  float    NULL, --新客项目数      
	--trcostcount   float    NULL, --烫染项目数      
	--cashbigcost   float    NULL, --现金大项      
	--cashsmallcost  float    NULL, --现金小项      
	--cashhulicost  float    NULL, --现金护理      
	--cardbigcost   float    NULL, --销卡大项      
	--cardsmallcost  float    NULL, --销卡小项      
	--cardhulicost  float    NULL, --销卡护理      
	--cardprocost   float    NULL, --疗程消费      
	--cardsgcost   float    NULL, --收购卡消费      
	--cardpointcost  float    NULL, --积分消费      
	--projectdycost  float    NULL, --项目抵用券      
	--cashdycost   float    NULL, --现金抵用券      
	--tmcardcost   float    NULL, --条卡卡消费      
	--salegoodsamt  float    NULL, --产品销售      
	--salecardsamt  float    NULL, --卡销售      
	--prochangeamt  float    NULL, --疗程兑换      
	--saletmkamt   float    NULL, --条码卡销售      
	--qhpayinner   float    NULL, --全韩店内支付      
	--qhpayouter   float    NULL, --全韩对方支付      
	--jdpayinner   float    NULL, --暨大店内支付      
	--smpayinner   float    NULL, --私密店内支付      
	--staffyeji   float    NULL, --员工提成合计      
	--staffcashyeji  float    NULL, --员工现金业绩合计      
 --)   

 
 --exec upg_all_personal_comm_paymode_04 '006','20140101','20140131',3
 --go
 --exec upg_all_personal_comm_paymode_04 '006','20140201','20140228',3
 --go
 --exec upg_all_personal_comm_paymode_04 '006','20140301','20140331',3
 --go
 --exec upg_all_personal_comm_paymode_04 '006','20140401','20140430',3

 --go
 --exec upg_all_personal_comm_paymode_04 '047','20140101','20140131',3
 --go
 --exec upg_all_personal_comm_paymode_04 '047','20140201','20140228',3
 --go
 --exec upg_all_personal_comm_paymode_04 '047','20140301','20140331',3
 --go
 --exec upg_all_personal_comm_paymode_04 '047','20140401','20140430',3

 -- go
 -- exec upg_all_personal_comm_paymode_04 '033','20140101','20140131',3
 --go
 --exec upg_all_personal_comm_paymode_04 '033','20140201','20140228',3
 --go
 --exec upg_all_personal_comm_paymode_04 '033','20140301','20140331',3
 --go
 --exec upg_all_personal_comm_paymode_04 '033','20140401','20140430',3


 -- go
 -- exec upg_all_personal_comm_paymode_04 '014','20140101','20140131',3
 --go
 --exec upg_all_personal_comm_paymode_04 '014','20140201','20140228',3
 --go
 --exec upg_all_personal_comm_paymode_04 '014','20140301','20140331',3
 --go
 --exec upg_all_personal_comm_paymode_04 '014','20140401','20140430',3

 --go
 -- exec upg_all_personal_comm_paymode_04 '041','20140101','20140131',3
 --go
 --exec upg_all_personal_comm_paymode_04 '041','20140201','20140228',3
 --go
 --exec upg_all_personal_comm_paymode_04 '041','20140301','20140331',3
 --go
 --exec upg_all_personal_comm_paymode_04 '041','20140401','20140430',3

 --go
 -- exec upg_all_personal_comm_paymode_04 '046','20140101','20140131',3
 --go
 --exec upg_all_personal_comm_paymode_04 '046','20140201','20140228',3
 --go
 --exec upg_all_personal_comm_paymode_04 '046','20140301','20140331',3
 --go
 --exec upg_all_personal_comm_paymode_04 '046','20140401','20140430',3


--go
--  exec upg_all_personal_comm_paymode_04 '029','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '029','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '029','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '029','20140401','20140430',3
 
--go
--  exec upg_all_personal_comm_paymode_04 '019','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '019','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '019','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '019','20140401','20140430',3
 
--go
--  exec upg_all_personal_comm_paymode_04 '008','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '008','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '008','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '008','20140401','20140430',3

--go
--  exec upg_all_personal_comm_paymode_04 '024','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '024','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '024','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '024','20140401','20140430',3


--go
--  exec upg_all_personal_comm_paymode_04 '030','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '030','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '030','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '030','20140401','20140430',3

--go
--  exec upg_all_personal_comm_paymode_04 '031','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '031','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '031','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '031','20140401','20140430',3

--go
--  exec upg_all_personal_comm_paymode_04 '035','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '035','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '035','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '035','20140401','20140430',3

--go
--  exec upg_all_personal_comm_paymode_04 '018','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '018','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '018','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '018','20140401','20140430',3

--go
--  exec upg_all_personal_comm_paymode_04 '016','20140101','20140131',3
-- go
-- exec upg_all_personal_comm_paymode_04 '016','20140201','20140228',3
-- go
-- exec upg_all_personal_comm_paymode_04 '016','20140301','20140331',3
-- go
-- exec upg_all_personal_comm_paymode_04 '016','20140401','20140430',3
delete mfscashanlysis
insert mfscashanlysis(compno,compname,staffno,staffname,staffinid,arrivaldate)
select a.compno,b.compname,staffno,staffname,manageno,arrivaldate from staffinfo a,companyinfo b
 where a.compno in ('006','047','033','014','041','046','008','019','029','024','030','031','035','018','016') and position='003'
 and a.compno=b.compno
 


update mfscashanlysis set cash_0401=ISNULL(staffcashyeji,0)
from mfscashanlysis ,(select person_inid,staffcashyeji=sum(ISNULL(staffcashyeji,0)) from  allstaff_work_analysis_04 where mmonth='20140101' group by  person_inid ) c
where person_inid=staffinid


update mfscashanlysis set cash_0402=ISNULL(staffcashyeji,0)
from mfscashanlysis ,(select person_inid,staffcashyeji=sum(ISNULL(staffcashyeji,0)) from  allstaff_work_analysis_04 where mmonth='20140201' group by  person_inid ) c
where person_inid=staffinid

update mfscashanlysis set cash_0403=ISNULL(staffcashyeji,0)
from mfscashanlysis ,(select person_inid,staffcashyeji=sum(ISNULL(staffcashyeji,0)) from  allstaff_work_analysis_04 where mmonth='20140301' group by  person_inid ) c
where person_inid=staffinid

update mfscashanlysis set cash_0404=ISNULL(staffcashyeji,0)
from mfscashanlysis ,(select person_inid,staffcashyeji=sum(ISNULL(staffcashyeji,0)) from  allstaff_work_analysis_04 where mmonth='20140401' group by  person_inid ) c
where person_inid=staffinid

delete mfscashanlysis where staffno like '%300'

select compno,compname,staffno,staffname,datediff(MONTH,arrivaldate,'20140501'),
convert(numeric(20,1),isnull(cash_0401,0)),convert(numeric(20,1),isnull(cash_0402,0)),
convert(numeric(20,1),isnull(cash_0403,0)),convert(numeric(20,1),isnull(cash_0404,0))
 from mfscashanlysis 
